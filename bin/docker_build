
set -o errexit
set -o pipefail
ORG=niktrix
name=tfb-coredns
VERSION=$(git rev-parse --short HEAD)

SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
ROOT_DIR=$(cd ${SCRIPT_DIR}/..; pwd)

dockerfile=${ROOT_DIR}/Dockerfile
cmd="build -t ${ORG}/${name}:${VERSION} -f ${dockerfile} "
docker ${cmd} ${ROOT_DIR}


echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
docker push ${ORG}/${name}
